# Makefile for Arnold

include objects.mak
include roms.mak

CC = @CC@
BIND = $(CC)
#   CFLAGS    flags for C compile
#   LFLAGS1   flags after output file spec, before obj file list
#   LFLAGS2   flags after obj file list (libraries, etc)

#use this for RedHat/SuSE Linux
X11INC = -I@x_includes@
X11LIB = -L@x_libraries@

# Use this for Solaris 2.5.1 with OpenWin
#X11INC = -I/usr/X11R6/include -I/usr/openwin/share/include
#X11LIB = -L/usr/X11R6/lib -L/usr/openwin/lib

X11LIBS = $(X11LIB) -lX11 -lXext

# Comment to following two lines to disable GTK+
GTKINC = @GTK_CFLAGS@
GTKLIB = @GTK_LIBS@

# Comment to following two lines to disable SDL
SDLINC = @SDL_CFLAGS@
SDLLIB = @SDL_LIBS@

# Comment to following two lines to disable ALSA
ALSAINC = @ALSA_CFLAGS@
ALSALIB = @ALSA_LIBS@

#-Wall for max warnings!
CFLAGS = @CPPFLAGS@ @CFLAGS@ $(GTKINC) $(SDLINC) $(ALSAINC) @DEFS@ $(X11INC) -I. -DUNIX -DCPC_LSB_FIRST -Wall -Wno-unused
#-g3 -pg -dm -dp -a
#LFLAGS1 = @LDFLAGS@ @LIBS@ $(GTKLIB) $(SDLLIB) $(ALSALIB) $(X11LIBS)
LFLAGS1 = @LDFLAGS@
#LFLAGS1 = @LDFLAGS@ -static $(SDLLIB) $(ALSALIB) -dynamic $(GTKLIB) @LIBS@ $(X11LIBS)
#debug
LFLAGS2 = @LIBS@ $(GTKLIB) $(SDLLIB) $(X11LIBS)
#LFLAGS2= -g3 -pg -dm -dp -a
#normal
#LFLAGS2 = -s

TARGET_CPU = @target_cpu@

arnold:  conditionals roms $(CPC_O) $(UNIX_O)
	$(BIND) -Wl,-b,binary,$(ROMS_BIN),-b,$(TARGET_FMT) -o arnold $(LFLAGS1) $(CPC_O) \
	$(UNIX_O) $(LFLAGS2)
	mv arnold ..

conditionals:
ifeq ($(TARGET_CPU),ppc)
TARGET_FMT=elf32-ppc
else
TARGET_FMT=elf32-i386
endif

roms:
	ln -s ../roms .

ctags:
	ctags -R
clean:
	rm -rf cpc/*.o
	rm -rf ifacegen/*.o
	rm -rf unix/*.o
	rm -rf cpc/debugger/*.o
	rm -rf cpc/diskimage/*.o
	rm -rf cpc/z80/*.o
	rm -rf tags
distclean: clean
	rm -rf *~ */*~
	rm Makefile
	rm config.cache
	rm config.log
	rm config.status
realclean: distclean
	rm aclocal.m4
	rm configure
archive:
	$(clean)
	cp makefile unix/makefile.unx
	zip -r cpccore.zip cpc
	zip -r ifacegen.zip ifacegen
	zip -r unix.zip unix
	zip -r roms.zip roms

